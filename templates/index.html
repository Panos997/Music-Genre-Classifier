<!DOCTYPE html>
<html lang="el">
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <title>AI Music Genre Predictor | Premium</title>
Â  Â  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
Â  Â  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
Â  Â  <style>
Â  Â  Â  Â  body {Â 
Â  Â  Â  Â  Â  Â  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;Â 
Â  Â  Â  Â  Â  Â  text-align: center;Â 
Â  Â  Â  Â  Â  Â  padding: 40px;Â 
Â  Â  Â  Â  Â  Â  background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);Â 
Â  Â  Â  Â  Â  Â  min-height: 100vh;
Â  Â  Â  Â  Â  Â  margin: 0;
Â  Â  Â  Â  Â  Â  color: #2d3436;Â 
Â  Â  Â  Â  }

Â  Â  Â  Â  .container {Â 
Â  Â  Â  Â  Â  Â  background: white;Â 
Â  Â  Â  Â  Â  Â  padding: 40px;Â 
Â  Â  Â  Â  Â  Â  border-radius: 30px;Â 
Â  Â  Â  Â  Â  Â  display: inline-block;Â 
Â  Â  Â  Â  Â  Â  box-shadow: 0 20px 50px rgba(0,0,0,0.1);Â 
Â  Â  Â  Â  Â  Â  width: 100%;Â 
Â  Â  Â  Â  Â  Â  max-width: 550px;Â 
Â  Â  Â  Â  }

Â  Â  Â  Â  .file-label {
Â  Â  Â  Â  Â  Â  display: block;
Â  Â  Â  Â  Â  Â  background: #f1f2f6;
Â  Â  Â  Â  Â  Â  border: 2px dashed #b2bec3;
Â  Â  Â  Â  Â  Â  padding: 20px;
Â  Â  Â  Â  Â  Â  border-radius: 15px;
Â  Â  Â  Â  Â  Â  margin-bottom: 20px;
Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  Â  Â  transition: all 0.3s;
Â  Â  Â  Â  Â  Â  color: #636e72;
Â  Â  Â  Â  Â  Â  font-weight: 500;
Â  Â  Â  Â  }
Â  Â  Â  Â  .file-label:hover { background: #dfe6e9; border-color: #1db954; }
Â  Â  Â  Â  .file-label.selected { border-color: #1db954; background: #e8f5e9; color: #1db954; }

Â  Â  Â  Â  #progressContainer {Â 
Â  Â  Â  Â  Â  Â  width: 100%;Â 
Â  Â  Â  Â  Â  Â  background: #dfe6e9;Â 
Â  Â  Â  Â  Â  Â  border-radius: 50px;Â 
Â  Â  Â  Â  Â  Â  margin: 25px 0;Â 
Â  Â  Â  Â  Â  Â  display: none;Â 
Â  Â  Â  Â  Â  Â  height: 28px;
Â  Â  Â  Â  Â  Â  overflow: hidden;
Â  Â  Â  Â  }

Â  Â  Â  Â  #progressBar {Â 
Â  Â  Â  Â  Â  Â  width: 0%;Â 
Â  Â  Â  Â  Â  Â  height: 100%;Â 
Â  Â  Â  Â  Â  Â  background: linear-gradient(90deg, #1db954, #1ed760);Â 
Â  Â  Â  Â  Â  Â  color: white;Â 
Â  Â  Â  Â  Â  Â  line-height: 28px;Â 
Â  Â  Â  Â  Â  Â  font-weight: 600;Â 
Â  Â  Â  Â  Â  Â  font-size: 13px;
Â  Â  Â  Â  Â  Â  transition: all 0.4s ease;Â 
Â  Â  Â  Â  }

Â  Â  Â  Â  button {Â 
Â  Â  Â  Â  Â  Â  background: linear-gradient(to right, #1db954, #191414);Â 
Â  Â  Â  Â  Â  Â  color: white;Â 
Â  Â  Â  Â  Â  Â  border: none;Â 
Â  Â  Â  Â  Â  Â  padding: 15px 40px;Â 
Â  Â  Â  Â  Â  Â  border-radius: 50px;Â 
Â  Â  Â  Â  Â  Â  cursor: pointer;Â 
Â  Â  Â  Â  Â  Â  font-size: 18px;Â 
Â  Â  Â  Â  Â  Â  font-weight: bold;Â 
Â  Â  Â  Â  Â  Â  box-shadow: 0 10px 20px rgba(29, 185, 84, 0.3);
Â  Â  Â  Â  Â  Â  margin-bottom: 10px;
Â  Â  Â  Â  }

Â  Â  Â  Â  .result-item {Â 
Â  Â  Â  Â  Â  Â  background: #f1f2f6;Â 
Â  Â  Â  Â  Â  Â  margin: 8px 0;Â 
Â  Â  Â  Â  Â  Â  padding: 12px;Â 
Â  Â  Â  Â  Â  Â  border-radius: 12px;
Â  Â  Â  Â  Â  Â  font-weight: 600;
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  justify-content: space-between;
Â  Â  Â  Â  }

Â  Â  Â  Â  canvas { margin-top: 30px; }
Â  Â  </style>
</head>
<body>

Â  Â  <div class="container">
Â  Â  Â  Â  <h1>ğŸµ Music Genre AI</h1>
Â  Â  Â  Â  <p>ÎˆÎ¾Ï…Ï€Î½Î· Î±Î½Î¬Î»Ï…ÏƒÎ· 3 ÏƒÎ·Î¼ÎµÎ¯Ï‰Î½ (Deep Scan)</p>
Â  Â  Â  Â Â 
Â  Â  Â  Â  <input type="file" id="audioFile" accept="audio/*" style="display: none;" onchange="updateFileName()">
Â  Â  Â  Â  <label for="audioFile" id="fileLabel" class="file-label">
Â  Â  Â  Â  Â  Â  ğŸ“ ÎšÎ¬Î½Ï„Îµ ÎºÎ»Î¹Îº Î³Î¹Î± Î½Î± ÎµÏ€Î¹Î»Î­Î¾ÎµÏ„Îµ Î±ÏÏ‡ÎµÎ¯Î¿
Â  Â  Â  Â  </label>
Â  Â  Â  Â Â 
Â  Â  Â  Â  <button onclick="processAndUpload()">ÎˆÎ½Î±ÏÎ¾Î· Î ÏÏŒÎ²Î»ÎµÏˆÎ·Ï‚</button>

Â  Â  Â  Â  <div id="progressContainer">
Â  Â  Â  Â  Â  Â  <div id="progressBar">Î ÏÎ¿ÎµÏ„Î¿Î¹Î¼Î±ÏƒÎ¯Î±...</div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div id="results" class="result-text"></div>
Â  Â  Â  Â  <canvas id="genreChart"></canvas>
Â  Â  </div>

Â  Â  <script>
Â  Â  Â  Â  // ÎšÎ±Ï„Î±Ï‡ÏÏÎ·ÏƒÎ· Ï„Î¿Ï… plugin Î¼ÏŒÎ½Î¹Î¼Ï‰Î½ labels
Â  Â  Â  Â  Chart.register(ChartDataLabels);

Â  Â  Â  Â  let myChart = null;
Â  Â  Â  Â  const chartColors = [
Â  Â  Â  Â  Â  Â  { start: '#1db954', end: '#1ed760' },Â 
Â  Â  Â  Â  Â  Â  { start: '#00b894', end: '#55efc4' },Â 
Â  Â  Â  Â  Â  Â  { start: '#2d3436', end: '#636e72' }
Â  Â  Â  Â  ];

Â  Â  Â  Â  function updateFileName() {
Â  Â  Â  Â  Â  Â  const input = document.getElementById('audioFile');
Â  Â  Â  Â  Â  Â  const label = document.getElementById('fileLabel');
Â  Â  Â  Â  Â  Â  if (input.files.length > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  label.innerHTML = `âœ… Î•Ï€Î¹Î»Î­Ï‡Î¸Î·ÎºÎµ: ${input.files[0].name}`;
Â  Â  Â  Â  Â  Â  Â  Â  label.classList.add('selected');
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  async function processAndUpload() {
Â  Â  Â  Â  Â  Â  const fileInput = document.getElementById('audioFile');
Â  Â  Â  Â  Â  Â  const progBar = document.getElementById('progressBar');
Â  Â  Â  Â  Â  Â  const progContainer = document.getElementById('progressContainer');
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if (!fileInput.files[0]) return alert("Î Î±ÏÎ±ÎºÎ±Î»Ï ÎµÏ€Î¹Î»Î­Î¾Ï„Îµ Ï€ÏÏÏ„Î± Î­Î½Î± Î±ÏÏ‡ÎµÎ¯Î¿!");

Â  Â  Â  Â  Â  Â  progContainer.style.display = "block";
Â  Â  Â  Â  Â  Â  progBar.style.width = "100%";
Â  Â  Â  Â  Â  Â  progBar.innerHTML = "Î•Ï€ÎµÎ¾ÎµÏÎ³Î±ÏƒÎ¯Î± Î´ÎµÎ¯Î³Î¼Î±Ï„Î¿Ï‚...";

Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  const trimmedBlob = await createSmartSample(fileInput.files[0]);
Â  Â  Â  Â  Â  Â  Â  Â  const formData = new FormData();
Â  Â  Â  Â  Â  Â  Â  Â  formData.append('file', trimmedBlob, "sample.wav");

Â  Â  Â  Â  Â  Â  Â  Â  const xhr = new XMLHttpRequest();
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  xhr.upload.onprogress = (e) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (e.lengthComputable) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const percent = Math.round((e.loaded / e.total) * 100);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  progBar.style.width = percent + "%";
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  progBar.innerHTML = "Uploading: " + percent + "%";
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  Â  Â  xhr.upload.onload = () => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  progBar.style.background = "linear-gradient(90deg, #f39c12, #f1c40f)";
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  progBar.innerHTML = "AI: Î•ÏÎ¼Î·Î½ÎµÎ¯Î± Ï„ÏÎ±Î³Î¿Ï…Î´Î¹Î¿Ï...";
Â  Â  Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  Â  Â  xhr.onload = () => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (xhr.status === 200) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const data = JSON.parse(xhr.responseText);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  renderChart(data);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showResults(data);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  progBar.style.background = "linear-gradient(90deg, #00b894, #55efc4)";
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  progBar.innerHTML = "ÎŸÎ»Î¿ÎºÎ»Î·ÏÏÎ¸Î·ÎºÎµ!";
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  Â  Â  xhr.open("POST", "/predict");
Â  Â  Â  Â  Â  Â  Â  Â  xhr.send(formData);
Â  Â  Â  Â  Â  Â  } catch (err) { alert("Î£Ï†Î¬Î»Î¼Î± ÎµÏ€ÎµÎ¾ÎµÏÎ³Î±ÏƒÎ¯Î±Ï‚."); }
Â  Â  Â  Â  }

Â  Â  Â  Â  async function createSmartSample(file) {
Â  Â  Â  Â  Â  Â  const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
Â  Â  Â  Â  Â  Â  const arrayBuffer = await file.arrayBuffer();
Â  Â  Â  Â  Â  Â  const audioBuffer = await audioCtx.decodeAudioData(arrayBuffer);
Â  Â  Â  Â  Â  Â  const sampleSecs = 10, rate = audioBuffer.sampleRate, chunkLen = sampleSecs * rate, totalLen = audioBuffer.length;
Â  Â  Â  Â  Â  Â  const startPos = 0, midPos = Math.max(0, Math.floor(totalLen / 2) - Math.floor(chunkLen / 2)), endPos = Math.max(0, totalLen - chunkLen);
Â  Â  Â  Â  Â  Â  const newBuffer = audioCtx.createBuffer(audioBuffer.numberOfChannels, chunkLen * 3, rate);
Â  Â  Â  Â  Â  Â  for (let ch = 0; ch < audioBuffer.numberOfChannels; ch++) {
Â  Â  Â  Â  Â  Â  Â  Â  const old = audioBuffer.getChannelData(ch), n = newBuffer.getChannelData(ch);
Â  Â  Â  Â  Â  Â  Â  Â  n.set(old.slice(startPos, startPos + chunkLen), 0);
Â  Â  Â  Â  Â  Â  Â  Â  n.set(old.slice(midPos, midPos + chunkLen), chunkLen);
Â  Â  Â  Â  Â  Â  Â  Â  n.set(old.slice(endPos, endPos + chunkLen), chunkLen * 2);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  return bufferToWav(newBuffer);
Â  Â  Â  Â  }

Â  Â  Â  Â  function bufferToWav(abuffer) {
Â  Â  Â  Â  Â  Â  let n = abuffer.numberOfChannels, len = abuffer.length * n * 2 + 44, buffer = new ArrayBuffer(len), view = new DataView(buffer), pos = 0;
Â  Â  Â  Â  Â  Â  const set16 = (d) => { view.setUint16(pos, d, true); pos += 2; }, set32 = (d) => { view.setUint32(pos, d, true); pos += 4; };
Â  Â  Â  Â  Â  Â  set32(0x46464952); set32(len - 8); set32(0x45564157); set32(0x20746d66); set32(16); set16(1); set16(n);
Â  Â  Â  Â  Â  Â  set32(abuffer.sampleRate); set32(abuffer.sampleRate * 2 * n); set16(n * 2); set16(16); set32(0x61746164); set32(len - pos - 4);
Â  Â  Â  Â  Â  Â  for(let i=0; i<abuffer.length; i++) { for(let ch=0; ch<n; ch++) {
Â  Â  Â  Â  Â  Â  Â  Â  let s = Math.max(-1, Math.min(1, abuffer.getChannelData(ch)[i]));
Â  Â  Â  Â  Â  Â  Â  Â  view.setInt16(pos, s < 0 ? s * 0x8000 : s * 0x7FFF, true); pos += 2;
Â  Â  Â  Â  Â  Â  }}
Â  Â  Â  Â  Â  Â  return new Blob([buffer], {type: "audio/wav"});
Â  Â  Â  Â  }

Â  Â  Â  Â  function showResults(data) {
Â  Â  Â  Â  Â  Â  const div = document.getElementById('results');
Â  Â  Â  Â  Â  Â  div.innerHTML = `<h3 style="margin:20px 0 10px 0;">ğŸ“Š Î‘Î½Î¬Î»Ï…ÏƒÎ·</h3>` +Â 
Â  Â  Â  Â  Â  Â  Â  Â  data.map((item, idx) => `<div class="result-item"><span>${item.genre}</span><span>${item.probability}%</span></div>`).join('');
Â  Â  Â  Â  }

Â  Â  Â  Â  function renderChart(data) {
Â  Â  Â  Â  Â  Â  const ctx = document.getElementById('genreChart').getContext('2d');
Â  Â  Â  Â  Â  Â  const gradients = data.map((_, i) => {
Â  Â  Â  Â  Â  Â  Â  Â  const g = ctx.createLinearGradient(0, 0, 0, 400);
Â  Â  Â  Â  Â  Â  Â  Â  g.addColorStop(0, chartColors[i % 3].start);
Â  Â  Â  Â  Â  Â  Â  Â  g.addColorStop(1, chartColors[i % 3].end);
Â  Â  Â  Â  Â  Â  Â  Â  return g;
Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  if (myChart) myChart.destroy();
Â  Â  Â  Â  Â  Â  myChart = new Chart(ctx, {
Â  Â  Â  Â  Â  Â  Â  Â  type: 'doughnut',
Â  Â  Â  Â  Â  Â  Â  Â  data: {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  labels: data.map(i => i.genre),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  datasets: [{
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  data: data.map(i => i.probability),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  backgroundColor: gradients,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  borderWidth: 2,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  borderColor: '#ffffff'
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }]
Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â  options: {Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  responsive: true,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  cutout: '65%',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  plugins: {Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  legend: { display: false },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Î¡Ï…Î¸Î¼Î¯ÏƒÎµÎ¹Ï‚ Î³Î¹Î± Ï„Î± Î¼ÏŒÎ½Î¹Î¼Î± Ï€Î¿ÏƒÎ¿ÏƒÏ„Î¬ Ï€Î¬Î½Ï‰ ÏƒÏ„Î¿ chart
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  datalabels: {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  color: '#ffffff',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  font: { weight: 'bold', size: 14 },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  formatter: (value) => value + '%',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  anchor: 'center',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  align: 'center',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  offset: 0,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  textShadowBlur: 4,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  textShadowColor: 'rgba(0,0,0,0.5)'
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  tooltip: {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  enabled: true,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  backgroundColor: '#2d3436',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  callbacks: {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  label: (context) => ` ${context.label}: ${context.raw}%`
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }Â 
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }
Â  Â  </script>
</body>
</html>
