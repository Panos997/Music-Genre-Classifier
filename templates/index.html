<!DOCTYPE html>
<html>
<head>
    <title>AI Music Genre Predictor</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; text-align: center; padding: 50px; background: #f4f4f9; }
        .container { background: white; padding: 30px; border-radius: 15px; display: inline-block; box-shadow: 0 8px 16px rgba(0,0,0,0.1); width: 450px; }
        
        /* Progress Bar Styling */
        #progressContainer { width: 100%; background-color: #ddd; border-radius: 10px; margin: 20px 0; display: none; }
        #progressBar { width: 0%; height: 20px; background-color: #1db954; border-radius: 10px; text-align: center; line-height: 20px; color: white; font-size: 12px; transition: width 0.3s; }
        
        .result { margin-top: 20px; font-weight: bold; }
        canvas { margin-top: 20px; max-width: 100%; }
        button { background: #1db954; color: white; border: none; padding: 10px 25px; border-radius: 20px; cursor: pointer; font-size: 16px; font-weight: bold; }
        input { margin-bottom: 15px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸµ Music Genre AI</h1>
        <p>Î‘Î½Î­Î²Î±ÏƒÎµ Î­Î½Î± MP3 Î³Î¹Î± Î±Î½Î¬Î»Ï…ÏƒÎ·</p>
        
        <input type="file" id="audioFile" accept="audio/*">
        <br>
        <button onclick="uploadFile()">Î ÏÏŒÎ²Î»ÎµÏˆÎ·!</button>

        <div id="progressContainer">
            <div id="progressBar">0%</div>
        </div>

        <div id="loading" style="display:none; margin-top: 10px;">â³ Î‘Î½Î±Î»ÏÏ‰ Ï„Î¿ Î±ÏÏ‡ÎµÎ¯Î¿...</div>
        
        <div class="result" id="results"></div>
        
        <canvas id="genreChart"></canvas>
    </div>

    <script>
        let myChart = null;

        async function uploadFile() {
            const fileInput = document.getElementById('audioFile');
            const resultsDiv = document.getElementById('results');
            const loading = document.getElementById('loading');
            const progContainer = document.getElementById('progressContainer');
            const progBar = document.getElementById('progressBar');
            
            if (!fileInput.files[0]) return alert("Î ÏÏŒÏƒÎ¸ÎµÏƒÎµ Î­Î½Î± Î±ÏÏ‡ÎµÎ¯Î¿!");

            const formData = new FormData();
            formData.append('file', fileInput.files[0]);

            progContainer.style.display = "block";
            progBar.style.width = "0%";
            progBar.style.backgroundColor = "#1db954"; // Î ÏÎ¬ÏƒÎ¹Î½Î¿ Î³Î¹Î± Ï„Î¿ upload
            progBar.innerHTML = "Î‘Î½Î­Î²Î±ÏƒÎ¼Î±...";
            
            if(myChart) myChart.destroy();

            const xhr = new XMLHttpRequest();
            
            // Î¦Î‘Î£Î— 1: Î ÏÎ±Î³Î¼Î±Ï„Î¹ÎºÏŒ Upload
            xhr.upload.addEventListener("progress", (e) => {
                if (e.lengthComputable) {
                    const percentComplete = Math.round((e.loaded / e.total) * 100);
                    // ÎšÏÎ±Ï„Î¬Î¼Îµ Ï„Î¿ upload Î¼Î­Ï‡ÏÎ¹ Ï„Î¿ 95% Î³Î¹Î± Î½Î± Î±Ï†Î®ÏƒÎ¿Ï…Î¼Îµ Ï‡ÏÏÎ¿ ÏƒÏ„Î¿ "processing"
                    const displayPercent = Math.floor(percentComplete * 0.95); 
                    progBar.style.width = displayPercent + "%";
                    progBar.innerHTML = "ÎœÎµÏ„Î±Ï†Î¿ÏÎ¬: " + displayPercent + "%";
                }
            });

            xhr.onreadystatechange = function () {
                if (xhr.readyState === XMLHttpRequest.DONE) {
                    if (xhr.status === 200) {
                        progBar.style.width = "100%";
                        progBar.innerHTML = "ÎŸÎ»Î¿ÎºÎ»Î·ÏÏÎ¸Î·ÎºÎµ!";
                        loading.style.display = "none";
                        const data = JSON.parse(xhr.responseText);
                        renderChart(data);
                    } else {
                        progBar.style.backgroundColor = "red";
                        progBar.innerHTML = "Î£Ï†Î¬Î»Î¼Î±!";
                    }
                }
            };

            // Î¦Î‘Î£Î— 2: ÎŒÏ„Î±Î½ Ï„Î¿ upload Ï„ÎµÎ»ÎµÎ¹ÏÏƒÎµÎ¹ (Load event)
            xhr.upload.onload = () => {
                progBar.style.backgroundColor = "#ffa500"; // Î Î¿ÏÏ„Î¿ÎºÎ±Î»Î¯ Î³Î¹Î± Ï„Î¿ Processing
                progBar.innerHTML = "Î‘Î½Î¬Î»Ï…ÏƒÎ· AI (Ï€Î±ÏÎ±ÎºÎ±Î»Ï Ï€ÎµÏÎ¹Î¼Î­Î½ÎµÏ„Îµ)...";
                // ÎœÎ¹ÎºÏÏŒ animation Î³Î¹Î± Î½Î± Ï†Î±Î¯Î½ÎµÏ„Î±Î¹ ÏŒÏ„Î¹ ÎºÎ¬Ï„Î¹ Î³Î¯Î½ÎµÏ„Î±Î¹
                let dots = 0;
                const interval = setInterval(() => {
                    if (xhr.readyState === XMLHttpRequest.DONE) clearInterval(interval);
                    dots = (dots + 1) % 4;
                    progBar.innerHTML = "Î‘Î½Î¬Î»Ï…ÏƒÎ· AI" + ".".repeat(dots);
                }, 500);
            };

            xhr.open("POST", "/predict", true);
            xhr.send(formData);
        }

        // Î— renderChart Ï€Î±ÏÎ±Î¼Î­Î½ÎµÎ¹ Î· Î¯Î´Î¹Î±...
    </script>
</body>
</html>
